<!DOCTYPE html>
<html>

<head>
    <title>Encoder Status</title>
    <script src="/jquery3.6.0.min.js"></script>

</head>

<body>

    <table border=1>
        <tr>
            <td>Calculated Alt Step per Revolution</td>
            <td><span id="calculateAltEncoderStepsPerRevolution">0</span></td>
            <td>Calculated Az Step per Revolution</td>
            <td><span id="calculateAzEncoderStepsPerRevolution">0</span></td>
        </tr>
        <tr>
            <td>Actual Alt Step per Revolution</td>
            <td><span id="actualAltEncoderStepsPerRevolution">0</span></td>
            <td>Actual Az Step per Revolution</td>
            <td><span id="actualAzEncoderStepsPerRevolution">0</span></td>
        </tr>

        <tr>
            <td>

            </td>
            <td>
                <button id="saveAltEncoderSteps">Save Alt Encoder Steps</button>
            </td>
            <td>

            </td>
            <td>
                <button id="saveAzEncoderSteps">Save Az Encoder Steps</button>
            </td>
        </tr>
    </table>

    <table border="1">
        <tr>
            <td id="platformConnected">
               
            </td>

            <td id="platformTracking">EQ Platform Tracking</td>
        </tr>
        <tr>
            <td>Time in minutes to middle</td>
            <td><span id="timeToMiddle">0</span></td>
        </tr>
        <tr>
            <td>Time in minutes to end of run</td>
            <td><span id="timeToEnd">0</span></td>
        </tr>
    </table>

    <table border="1">
        <tr>
            <td>Last Synced Ra</td>
            <td>
                <span id="lastSyncedRa">0</span>
            </td>
        </tr>
        <tr>
            <td>Last Synced Dec</td>
            <td>
                <span id="lastSyncedDec">0</span>
            </td>
        </tr>
        <td>Last Synced Alt</td>
        <td>
            <span id="lastSyncedAlt">0</span>
        </td>
        </tr>
        <td>Last Synced Az</td>
        <td>
            <span id="lastSyncedAz">0</span>
        </td>
        </tr>


    </table>

    <button id="clearPreferences">Clear Preferences</button>
    <br>
    <button id="clearAlignment">Clear saved alignment</button>
    <br>
    Run this after : <br>
    - Power on <br>
    - Centering platform <br>
    - Setting lat long time thorugh planetarium <br>

    <button id="performZeroedAlignment">Perform Zeroed Alignment</button>

   <br>
    <iframe id="eqIframe" style="display:none;"></iframe>

    <script>

        function update() {
            console.log("Update ");

            $.getJSON("/getScopeStatus").done(function (data) {

                $("#calculateAltEncoderStepsPerRevolution").text(data.calculateAltEncoderStepsPerRevolution);
                $("#calculateAzEncoderStepsPerRevolution").text(data.calculateAzEncoderStepsPerRevolution);
                $("#actualAltEncoderStepsPerRevolution").text(data.actualAltEncoderStepsPerRevolution);
                $("#actualAzEncoderStepsPerRevolution").text(data.actualAzEncoderStepsPerRevolution);
                $("#timeToMiddle").text(data.timeToMiddle);
                $("#lastSyncedRa").text(data.lastSyncedRa);
                $("#lastSyncedDec").text(data.lastSyncedDec);
                $("#lastSyncedAlt").text(data.lastSyncedAlt);
                $("#lastSyncedAz").text(data.lastSyncedAz);
                $("#platformConnected").css("background-color", data.platformConnected ? "green" : "red");
                if (data.platformConnected && data.eqPlatformIP) {
                    $("#eqIframe").attr("src", "http://" + data.eqPlatformIP).show();
                    $("#platformConnected").text("EQ Platform Connected");
                } else {
                    $("#eqIframe").removeAttr("src").hide();
                    $("#platformConnected").text("EQ Platform Not Connected");
                }
                $("#platformTracking").css("background-color", data.platformTracking ? "green" : "red");
            }).fail(function () {
                console.error("Failed to get data.");
            });


        };

        $("#clearPreferences").click(function () {
            $.post("/clearPreferences");
        });

        $("#clearAlignment").click(function () {
            $.post("/clearAlignment");
        });

        $("#performZeroedAlignment").click(function () {
            $.post("/performZeroedAlignment");
        });

        $("#saveAltEncoderSteps").click(function () {
            $.post("/saveAltEncoderSteps");
        });

        $("#saveAzEncoderSteps").click(function () {
            $.post("/saveAzEncoderSteps");
        });





        setInterval(update, 1000);
    </script>
</body>

</html>