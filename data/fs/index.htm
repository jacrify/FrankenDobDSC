<!DOCTYPE html>
<html>

<head>
    <title>Encoder Status</title>
    <script src="/jquery3.6.0.min.js"></script>

</head>

<body>

    <table border=1>
        <tr>
            <td><label for="altEncoderAlignValue1">Alt Encoder Align Point 1:</label></td>
            <td><span id="altEncoderAlignValue1">0</span></td>
            <td><label for="altEncoderAlignValue2">Alt Encoder Align Point 2:</label></td>
            <td><span id="altEncoderAlignValue2">0</span></td>
        </tr>
        <tr>
            <td><label for="azEncoderAlignValue1">Az Encoder Align Point 1:</label></td>
            <td><span id="azEncoderAlignValue1">0</span></td>
            <td><label for="azEncoderAlignValue2">Az Encoder Align Point 2:</label></td>
            <td><span id="azEncoderAlignValue2">0</span></td>
        </tr>
        <tr>
            <td><label for="altAlignValue1">Actual Alt at Point 1:</label></td>
            <td><span id="altAlignValue1">0</span></td>
            <td><label for="altAlignValue2">Actual Alt at Point 2:</label></td>
            <td><span id="altAlignValue2">0</span></td>
        </tr>
        <tr>
            <td><label for="azAlignValue1">Actual Az at Point 1:</label></td>
            <td><span id="azAlignValue1">0</span></td>
            <td><label for="azAlignValue2">Actual Az at Point 2:</label></td>
            <td><span id="azAlignValue2">0</span></td>
        </tr>
        <tr>
            <td><label for="calculateAltEncoderStepsPerRevolution">Calculated Alt Step per Revolution</label></td>
            <td><span id="calculateAltEncoderStepsPerRevolution">0</span></td>
            <td><label for="calculateAzEncoderStepsPerRevolution">Calculated Az Step per Revolution</label></td>
            <td><span id="calculateAzEncoderStepsPerRevolution">0</span></td>
        </tr>
        <tr>
            <td><label for="actualAltEncoderStepsPerRevolution">Actual Alt Step per Revolution</label></td>
            <td><span id="actualAltEncoderStepsPerRevolution">0</span></td>
            <td><label for="actualAzEncoderStepsPerRevolution">Actual Az Step per Revolution</label></td>
            <td><span id="actualAzEncoderStepsPerRevolution">0</span></td>
        </tr>
        <tr>
            <td>

            </td>
            <td>
                <button id="saveAltEncoderSteps">Save Alt Encoder Steps</button>
            </td>
            <td>

            </td>
            <td>
                <button id="saveAzEncoderSteps">Save Az Encoder Steps</button>
            </td>
        </tr>
    </table>

    <table border="1">
        <tr>
            <td>Alt Position Error</td>
            <td><span id="altOffsetToAddToEncoderResult">0</span></td>
        </tr>
    <tr>
        <td>Az Position Error</td>
        <td><span id="azOffsetToAddToEncoderResult">0</span></td>
    </tr>
    </table>
    <table border="1">
        <tr>

            <td id="platformConnected">EQ Platform Connected</td>
            <td id="platformTracking">EQ Platform Tracking</td>
        </tr>
        <tr>
            <td>Time in minutes to middle</td>
            <td><span id="timeToMiddle">0</span></td>
        </tr>
        <tr>
            <td>Time in minutes to end of run</td>
            <td><span id="timeToEnd">0</span></td>
        </tr>
    </table>

    <table border="1">
        <tr>
            <td>Last Synced Ra</td>
            <td>
                <span="lastSyncedRa">0</span>
            </td>
        </tr>
        <tr>
            <td>Last Synced Dec</td>
            <td>
                <span="lastSyncedDec">0</span>
            </td>
        </tr>
        <td>Last Synced Alt</td>
        <td>
            <span="lastSyncedAlt">0</span>
        </td>
        </tr>
        <td>Last Synced Az</td>
        <td>
            <span="lastSyncedAz">0</span>
        </td>
        </tr>

        <tr>
            <td><button id="addRefPoint" >Add reference point</button></td>
            <td></td>
        </tr>

    </table>
    <a href="/clearPrefs"> Clear saved preferences</a>

    <script>

        function update() {
            console.log("Update ");

            $.getJSON("/getScopeStatus").done(function (data) {
                $("#altEncoderAlignValue1").text(data.altEncoderAlignValue1);
                $("#altEncoderAlignValue2").text(data.altEncoderAlignValue2);
                $("#azEncoderAlignValue1").text(data.azEncoderAlignValue1);
                $("#azEncoderAlignValue2").text(data.azEncoderAlignValue2);
                $("#altAlignValue1").text(data.altAlignValue1);
                $("#altAlignValue2").text(data.altAlignValue2);
                $("#azAlignValue1").text(data.azAlignValue1);
                $("#azAlignValue2").text(data.azAlignValue2);
                $("#calculateAltEncoderStepsPerRevolution").text(data.calculateAltEncoderStepsPerRevolution);
                $("#calculateAzEncoderStepsPerRevolution").text(data.calculateAzEncoderStepsPerRevolution);
                $("#actualAltEncoderStepsPerRevolution").text(data.actualAltEncoderStepsPerRevolution);
                $("#actualAzEncoderStepsPerRevolution").text(data.actualAzEncoderStepsPerRevolution);
                $("#timeToMiddle").text(data.timeToMiddle);
                $("#lastSyncedRa").text(data.lastSyncedRa);
                $("#lastSyncedDec").text(data.lastSyncedDec);
                $("#lastSyncedAlt").text(data.lastSyncedAlt);
                $("#lastSyncedAz").text(data.lastSyncedAz);
                $("#altOffsetToAddToEncoderResult").text(data.altOffsetToAddToEncoderResult);
                $("#azOffsetToAddToEncoderResult").text(data.azOffsetToAddToEncoderResult);
                $("#platformConnected").css("background-color", data.platformConnected ? "green" : "red");
                $("#platformTracking").css("background-color", data.platformTracking ? "green" : "red");
            }).fail(function () {
                console.error("Failed to get data.");
            });


        };

        $("#saveAltEncoderSteps").click(function () {
            $.post("/saveAltEncoderSteps");
        });


        $("#addRefPoint").click(function () {
                $.post("/addRefPoint");
            });
        

        $("#saveAzEncoderSteps").click(function () {
            $.post("/saveAzEncoderSteps");
        });





        setInterval(update, 1000);
    </script>
</body>

</html>